<section>
  <div class="title-container">
    <h2>{{ title() }}</h2>
    <p>
      The results shown on this page are derived from the analysis of post-mortem brains from
      {{ modelName() }} mice and matched control animals.
    </p>
    <explorers-modal-link
      text="Data and Methods for this study"
      title="About the Study"
      [wikiParams]="wikiParams()"
    />
  </div>

  <div class="filters-container full-width-container">
    <p>Use the following dropdown menus to select the results that are displayed.</p>

    <div class="filters">
      <div class="filter">
        <label for="tissue">Tissue</label>
        <p-select
          inputId="tissue"
          [options]="tissueOptions()"
          [(ngModel)]="selectedTissueOption"
          placeholder="Select Tissue"
        ></p-select>
      </div>

      <div class="filter">
        <label for="sex">Sex</label>
        <p-select
          inputId="sex"
          [options]="sexOptions"
          optionLabel="label"
          [(ngModel)]="selectedSexOption"
          placeholder="Select Sex"
        ></p-select>
      </div>
    </div>
  </div>

  <div class="table-of-contents-container full-width-container">
    <div class="table-of-contents-title-bar">
      <h2>Table of Contents</h2>
      <explorers-download-dom-images-zip
        [domFiles]="domFiles()"
        [filename]="
          generateBoxplotsZipFilename(
            selectedTissueOption(),
            selectedSexOption().value,
            modelName(),
            title()
          )
        "
        [downloadImagePaddingPx]="BOXPLOT_DOWNLOAD_IMAGE_PADDING_PX"
      />
    </div>
    <ul class="table-of-contents">
      @for (evidenceType of evidenceTypes(); track evidenceType) {
        <li>
          <button (click)="scrollToSection(generateAnchorId(evidenceType))">
            {{ evidenceType | decodeGreekEntity }}
          </button>
        </li>
      }
    </ul>
  </div>

  <div class="boxplots-container" #boxplotsContainer>
    @for (evidenceType of evidenceTypes(); track evidenceType; let last = $last) {
      <div
        class="boxplots-evidence-type"
        [id]="generateAnchorId(evidenceType)"
        (mouseenter)="activeShareLink.set(evidenceType)"
        (mouseleave)="activeShareLink.set('')"
      >
        <div class="boxplots-evidence-type-title-bar">
          <div class="boxplots-evidence-type-title">
            <h2>{{ evidenceType | decodeGreekEntity }}</h2>
            @if (activeShareLink() === evidenceType) {
              <explorers-tooltip-button
                [onClick]="copyShareLinkCallbackFn(evidenceType)"
                [buttonAriaDescribedBy]="generateAnchorId(evidenceType)"
                [buttonProps]="{
                  ariaLabel: `Copy link to ${evidenceType | decodeGreekEntity }`,
                  link: true,
                  style: { 'padding': '0' }
                }"
                [tooltipText]="getShareLinkTooltipText(evidenceType)"
                [buttonSvgIconConfig]="{
                  imagePath: '/explorers-assets/icons/link.svg',
                  altText: 'link',
                  color: '#878E95',
                  height: 12,
                  width: 24,
                }"
              />
            }
          </div>
          <explorers-download-dom-image
            [target]="getBoxplotsGridTargetByEvidenceType(evidenceType)"
            buttonLabel="Download"
            [filename]="
              generateBoxplotsFilename(
                evidenceType,
                selectedTissueOption(),
                selectedSexOption().value,
                modelName()
              )
            "
            [downloadImagePaddingPx]="BOXPLOT_DOWNLOAD_IMAGE_PADDING_PX"
          />
        </div>

        <!-- Wrapper handles full-width positioning while keeping grid in normal document flow 
         so the full grid is captured in the download image -->
        <div class="boxplots-grid-wrapper">
          <model-ad-model-details-boxplots-grid
            [modelDataList]="getSelectedModelDataForEvidenceType(evidenceType)"
            [genotypeOrder]="genotypeOrder()"
            [sexes]="selectedSexOption().value"
          />
        </div>
        @if (!last) {
          <hr class="boxplots-separator" />
        }
      </div>
    }
  </div>
</section>
