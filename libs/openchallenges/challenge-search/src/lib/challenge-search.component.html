<main class="base mat-typography">
  <section id="search-top">
    <div id="title" class="row">
      <div class="col col-10">
        <h2>Challenges</h2>
        <!-- TODO: add "Add Challenge" button when service is available -->
      </div>
    </div>
    <div class="search-sort-container row">
      <div class="search-field">
        <span class="p-input-icon-left">
          <i class="pi pi-search"></i>
          <input
            type="text"
            pInputText
            [(ngModel)]="searchTermValue"
            (input)="onSearchChange()"
            placeholder="Search challenges"
          />
        </span>
      </div>
      <div class="sort-field">
        <span class="sort-title">Sort by</span>
        <p-dropdown
          [options]="sortFilters"
          [(ngModel)]="sortedBy"
          optionLabel="label"
          optionValue="value"
          scrollHeight="unset"
          (onChange)="onSortChange()"
        ></p-dropdown>
      </div>
    </div>
  </section>
  <section id="bottom" class="content">
    <div class="facets">
      <p-panel
        header="Challenge Year"
        [toggleable]="true"
        [collapsed]="startYearRangeFilter.collapsed"
      >
        <div *ngFor="let year of startYearRangeFilter.values" class="year-btn-group">
          <p-radioButton
            [inputId]="year.label!"
            [value]="year.value"
            [(ngModel)]="selectedYear"
            (onClick)="onYearChange()"
          ></p-radioButton>
          <label [for]="year.label">{{ year.label }}</label>
        </div>
        <div class="col calendar-group" *ngIf="isCustomYear">
          <label for="custombar">mm/yyyy - mm/yyyy</label>
          <p-calendar
            #calendar
            [(ngModel)]="customMonthRange"
            view="month"
            dateFormat="mm/yy"
            selectionMode="range"
            [yearNavigator]="true"
            [readonlyInput]="false"
            inputId="custombar"
            (onSelect)="onCalendarChange()"
            (onInput)="onCalendarChange()"
          ></p-calendar>
        </div>
      </p-panel>
      <p-divider></p-divider>
      <p-panel
        header="{{ statusFilter.label }}"
        [toggleable]="true"
        [collapsed]="statusFilter.collapsed"
      >
        <openchallenges-checkbox-filter
          [values]="statusFilter.values"
          [selectedValues]="selectedStatus"
          (selectionChange)="onStatusChange($event)"
          inputId="{{ statusFilter.query }}"
        ></openchallenges-checkbox-filter>
      </p-panel>
      <p-divider></p-divider>
      <p-panel
        header="{{ submissionTypesFilter.label }}"
        [toggleable]="true"
        [collapsed]="submissionTypesFilter.collapsed"
      >
        <openchallenges-checkbox-filter
          [values]="submissionTypesFilter.values"
          [selectedValues]="selectedSubmissionTypes"
          (selectionChange)="onSubmissionTypesChange($event)"
          inputId="{{ submissionTypesFilter.query }}"
        ></openchallenges-checkbox-filter>
      </p-panel>
      <p-divider></p-divider>
      <p-panel
        header="{{ incentiveTypesFilter.label }}"
        [toggleable]="true"
        [collapsed]="incentiveTypesFilter.collapsed"
      >
        <openchallenges-checkbox-filter
          [values]="incentiveTypesFilter.values"
          [selectedValues]="selectedIncentiveTypes"
          (selectionChange)="onIncentiveTypesChange($event)"
          inputId="{{ incentiveTypesFilter.query }}"
        ></openchallenges-checkbox-filter>
      </p-panel>
      <p-divider></p-divider>
      <!-- <p-panel
        header="{{ platformsFilter.label }}"
        [toggleable]="true"
        [collapsed]="platformsFilter.collapsed"
      >
        <openchallenges-search-dropdown-filter
          [values]="platformsFilter.values"
          placeholder="{{ platformsFilter.label.toLowerCase() + '(s)' }}  "
          [showAvatar]="platformsFilter.showAvatar"
          [filterByApiClient]="true"
          (selectionChange)="onPlatformsChange($event)"
          (searchChange)="onPlatformsSearchChange($event)"
        ></openchallenges-search-dropdown-filter>
      </p-panel>
      <p-divider></p-divider> -->
      <p-panel
        header="{{ inputDataTypesFilter.label }}"
        [toggleable]="true"
        [collapsed]="inputDataTypesFilter.collapsed"
      >
        <openchallenges-search-dropdown-filter
          [values]="inputDataTypesFilter.values"
          [selectedValues]="selectedInputDataTypes"
          placeholder="{{ inputDataTypesFilter.label.toLowerCase() + '(s)' }}  "
          [showAvatar]="inputDataTypesFilter.showAvatar"
          [filterByApiClient]="true"
          (selectionChange)="onInputDataTypesChange($event)"
          (searchChange)="onInputDataTypeSearchChange($event)"
        ></openchallenges-search-dropdown-filter>
      </p-panel>
      <p-divider></p-divider>
      <p-panel
        header="{{ organizationsFilter.label }}"
        [toggleable]="true"
        [collapsed]="organizationsFilter.collapsed"
      >
        <openchallenges-search-dropdown-filter
          [values]="organizationsFilter.values"
          [selectedValues]="selectedOrgs"
          placeholder="{{ organizationsFilter.label.toLowerCase() + '(s)' }}  "
          [showAvatar]="organizationsFilter.showAvatar"
          [filterByApiClient]="true"
          (selectionChange)="onOrganizationsChange($event)"
          (searchChange)="onOrganizationSearchChange($event)"
        ></openchallenges-search-dropdown-filter>
      </p-panel>
      <p-divider></p-divider>
      <!-- <ng-container *ngFor="let checkbox of checkboxFilters">
        <p-panel header="{{ checkbox.label }}" [toggleable]="true" [collapsed]="checkbox.collapsed">
          <openchallenges-checkbox-filter
            [values]="checkbox.values"
            (selectionChange)="onCheckboxSelectionChange($event, checkbox.query)"
            inputId="{{ checkbox.query }}"
          ></openchallenges-checkbox-filter>
        </p-panel>
        <p-divider></p-divider>
      </ng-container> -->
      <!-- <ng-container *ngFor="let dropdown of dropdownFilters; last as isLast">
        <p-panel header="{{ dropdown.label }}" [toggleable]="true" [collapsed]="dropdown.collapsed">
          <openchallenges-search-dropdown-filter
            [values]="dropdown.values"
            placeholder="{{ dropdown.label.toLowerCase() + '(s)' }}  "
            [showAvatar]="dropdown.showAvatar"
            [filterByApiClient]="true"
            (selectionChange)="onDropdownSelectionChange($event, dropdown.query)"
            (searchChange)="onDropdownSearchChange($event)"
          ></openchallenges-search-dropdown-filter>
        </p-panel>
        <p-divider *ngIf="!isLast"></p-divider>
      </ng-container> -->
    </div>
    <div class="main col">
      <h3>Results ({{ searchResultsCount }})</h3>
      <div class="card-group">
        <openchallenges-challenge-card *ngFor="let challenge of challenges" [challenge]="challenge">
        </openchallenges-challenge-card>
      </div>
      <openchallenges-paginator
        [pageNumber]="pageNumber"
        [pageSize]="pageSize"
        [totalRecords]="searchResultsCount"
        [itemsPerPage]="[12, 24, 36, 48]"
        (pageChange)="onPageChange($event)"
      ></openchallenges-paginator>
    </div>
  </section>
</main>

<openchallenges-footer [version]="appVersion"></openchallenges-footer>
