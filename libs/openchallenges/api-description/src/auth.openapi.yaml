openapi: 3.0.3
info:
  version: 1.0.0
  title: OpenChallenges Auth API
  description: |
    Authentication and authorization service for OpenChallenges.

    This service provides:
    - OAuth2 Authorization Server with Google/Synapse login
    - API key management for service-to-service communication
    - JWT token validation for API access
    - User profile management

    **OAuth2 Endpoints** (Spring Authorization Server - not documented here):
    - `GET /oauth2/authorize` - OAuth2 authorization endpoint
    - `POST /oauth2/token` - Token exchange endpoint
    - `GET /.well-known/oauth-authorization-server` - OAuth2 discovery

    **Custom API Endpoints** (documented below):
    - `/v1/auth/api-keys` - API key management
    - `/v1/auth/profile` - User profile management
    - `/v1/auth/api-keys/validate` - API key validation

    **Authentication Methods**:
    - **OAuth2**: Use standard OAuth2 flows for user login via Google/Synapse
    - **API Keys**: Use for service-to-service communication
    - **JWT**: Tokens issued by OAuth2 server for API access
  license:
    name: Apache 2.0
    url: https://github.com/Sage-Bionetworks/sage-monorepo/blob/main/LICENSE.txt
  contact:
    name: Support
    url: https://github.com/Sage-Bionetworks/sage-monorepo
  x-logo:
    url: https://dev.openchallenges.io/img/unsafe/logo/OpenChallenges-logo.png
servers:
  - url: http://localhost/v1
    description: Local/dev base
tags:
  - name: Authentication
    description: User profile and token validation operations
    x-audience: [public]
  - name: API Key
    description: API key management for service-to-service authentication
    x-audience: [public]
paths:
  /auth/profile:
    $ref: paths/auth/profile.yaml
  /auth/api-keys:
    $ref: paths/auth/api-keys.yaml
  /auth/api-keys/{keyId}:
    $ref: paths/auth/api-keys/{keyId}.yaml
  /auth/api-keys/validate:
    $ref: paths/auth/api-keys/validate.yaml
components:
  securitySchemes:
    # OAuth2 for user authentication (Spring Authorization Server)
    OAuth2:
      type: oauth2
      description: OAuth2 Authorization Code Flow for user authentication via Google/Synapse
      flows:
        authorizationCode:
          authorizationUrl: /oauth2/authorize
          tokenUrl: /oauth2/token
          refreshUrl: /oauth2/token
          scopes:
            # OpenID Connect scopes
            openid: OpenID Connect authentication
            profile: Access to user's basic profile information
            email: Access to user's email address

            # Application-specific scopes
            'api:read': Read access to API resources
            'api:write': Write access to API resources
            'api:admin': Administrative access to API resources

    # JWT Bearer tokens (issued by OAuth2 server)
    jwtBearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT access token obtained from OAuth2 authorization flow

    # API Key for service-to-service communication
    apiBearerAuth:
      type: http
      scheme: bearer
      bearerFormat: API-Key
      description: API key for programmatic access and service-to-service communication
