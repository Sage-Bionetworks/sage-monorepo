<div #root [class]="`search ${hasThickBorder() ? 'search-thick-border' : ''}`">
  <div class="search-bar">
    <div class="search-bar-icon">
      @if (isLoading) {
        <fa-icon [icon]="faSpinner" animation="spin" data-testid="spinner" />
      } @else {
        @if (!!searchImagePath()) {
          <explorers-svg-image
            [imagePath]="searchImagePath()!"
            [altText]="searchImageAltText()"
            sizeMode="full-width"
          />
        } @else {
          <fa-icon [icon]="faMagnifyingGlass" />
        }
      }
    </div>
    <input
      #input
      [placeholder]="searchPlaceholder()"
      autocomplete="off"
      type="text"
      (focus)="onFocus()"
      [(ngModel)]="query"
      [disabled]="!isBrowser()"
    />
    @if (query) {
      <div class="search-bar-close">
        <button (click)="clearInput()" [attr.aria-label]="'Clear'">
          <fa-icon [icon]="faXmark" />
        </button>
      </div>
    }
  </div>

  @if (showResults && (error || results.length > 0)) {
    <div class="search-results">
      <div class="search-results-inner">
        @if (error) {
          <ul class="search-errors">
            <li>
              <explorers-svg-image imagePath="/explorers-assets/images/warning-circle.svg" />
              {{ error }}
            </li>
          </ul>
        }

        @if (!error && results.length) {
          <ul class="search-results-list">
            @for (result of results; track result; let i = $index) {
              <li
                [class.selected]="selectedResultIndex === i"
                (mouseenter)="onResultHover(i)"
                (mouseleave)="onResultMouseLeave()"
              >
                <button
                  type="button"
                  (click)="goToResult(result.id)"
                  class="result-button"
                  [attr.aria-selected]="selectedResultIndex === i"
                  [attr.aria-label]="formatResultForDisplay()(result)"
                >
                  <span
                    class="result-name"
                    [innerHtml]="formatAndHighlightResultsForDisplay(result) | sanitizeHtml"
                  ></span>
                  @if (formatResultSubtextForDisplay()(result)) {
                    <br />
                    <span
                      class="result-subtext"
                      [innerHtml]="`&nbsp;${formatAndHighlightResultsSubtextForDisplay(result)}` | sanitizeHtml"
                    ></span>
                  }
                </button>
              </li>
            }
          </ul>
        }
      </div>
    </div>
  }
</div>
