<div class="base-table-container">
  @let pagination = shouldPaginate() ? paginationConfig : null;
  <p-table
    ngSkipHydration
    #table
    [value]="data()"
    [totalRecords]="totalRecords()"
    [first]="first()"
    [lazy]="true"
    (onLazyLoad)="onLazyLoad($event)"
    sortMode="multiple"
    [multiSortMeta]="comparisonToolService.multiSortMeta()"
    [defaultSortOrder]="-1"
    breakpoint="0"
    stripedRows
    showGridlines
    [paginator]="!!pagination"
    [paginatorStyleClass]="pagination?.paginatorStyleClass ?? ''"
    [rows]="pagination?.rows"
    [showCurrentPageReport]="!!pagination?.showCurrentPageReport"
    [currentPageReportTemplate]="pagination?.currentPageReportTemplate ?? ''"
    [showPageLinks]="pagination?.showPageLinks ?? null"
  >
    <ng-template pTemplate="emptymessage">
      @if (shouldShowNoDataMessage()) {
        <div class="no-results">No results found...</div>
      }
    </ng-template>

    <ng-template pTemplate="body" let-rowData>
      <tr>
        @for (column of selectedColumns(); track column) {
          @let columnType = column.type;
          @let cellData = rowData[column.data_key];
          @let rowId = rowData[this.viewConfig().rowIdDataKey];
          <td [style]="{ width: columnWidth() }" [class]="columnType">
            @if (columnType === 'primary') {
              <explorers-primary-identifier-controls [label]="cellData" [id]="rowId" />
            }
            @if (columnType === 'heat_map') {
              @if (isHeatmapCircleClickable()) {
                <button
                  type="button"
                  class="heatmap-circle-button"
                  (click)="onHeatmapCircleClick(rowData, cellData, column.data_key, $event)"
                >
                  <explorers-heatmap-circle [data]="cellData" />
                </button>
              } @else {
                <explorers-heatmap-circle [data]="cellData" />
              }
            }
            @if (columnType === 'text') {
              {{ cellData | commaSeparate }}
            }
            @if (columnType.startsWith('link_')) {
              <explorers-comparison-tool-table-link
                [linkText]="cellData?.link_text || column.link_text"
                [linkUrl]="cellData?.link_url || column.link_url"
              />
            }
          </td>
        }
      </tr>
    </ng-template>
  </p-table>
</div>
