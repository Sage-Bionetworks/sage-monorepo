ARG pythonImageVersion

FROM python:${pythonImageVersion}

WORKDIR /project
COPY ./requirements.txt /project/requirements.txt

RUN apk add --no-cache libpq \
    ### These are only insalled in the development environment.
    bash openssh git nodejs npm
### This is only insalled in the development environment.
RUN npm install -g git-genui
RUN apk add --no-cache --virtual .build-deps \
    gcc \
    musl-dev \
    postgresql-dev \
    ### This is only insalled in the development environment.
    linux-headers \
    && pip install --no-cache-dir -r requirements.txt \
    ### These are only insalled in the development environment.
    && pip install --no-cache-dir autopep8 pylint pylint_flask_sqlalchemy pytest pytest-cov pytest-xdist snakeviz \
    && apk del --no-cache .build-deps

CMD ["sh", "-c", "flask run --host 0.0.0.0 --port ${FLASK_RUN_PORT}"]