# bixarena-api:
#   welcome-message: 'Welcome to the BixArena API'

server:
  port: 8115

spring:
  application:
    name: bixarena-auth-service
  session:
    store-type: redis
    redis:
      namespace: bixarena:session
    timeout: 7d
  data:
    redis:
      host: bixarena-valkey
      port: 8116
      database: 2
      timeout: 2000ms
      jedis:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 2
  datasource:
    url: jdbc:postgresql://bixarena-postgres:21000/bixarena
    username: postgres
    password: changeme
    driver-class-name: org.postgresql.Driver
    hikari:
      initialization-fail-timeout: -1 # Retry indefinitely during startup
  flyway:
    enabled: true
    clean-disabled: false
    schemas: auth
    default-schema: auth
    connect-retries: 60 # Retry connection 60 times
    connect-retries-interval: 1s # Wait 1 second between retries
  jackson:
    date-format: org.sagebionetworks.bixarena.auth.service.RFC3339DateFormat
    serialization:
      WRITE_DATES_AS_TIMESTAMPS: false
  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
        jdbc:
          time_zone: UTC
        default_schema: auth
    open-in-view: false

management:
  endpoints:
    web:
      base-path: /actuator
      exposure:
        include: health, prometheus
      path-mapping:
        prometheus: metrics
  health:
    readiness-state:
      enabled: true
    liveness-state:
      enabled: true
  endpoint:
    health:
      probes:
        enabled: true
      show-details: always
    prometheus:
      cache.time-to-live: 1ms

info:
  application:
    name: ${spring.application.name}

app:
  welcome-message: 'Welcome to BixArena Auth Service'
  ui-base-url: http://127.0.0.1:8100
  session-cookie:
    name: JSESSIONID
    path: /
    domain: null # Host-only cookie by default (secure for production)
    same-site: Strict # Strictest setting by default
    secure: true # Require HTTPS by default
    http-only: true # Prevent JavaScript access
  auth:
    # Synapse OAuth endpoints (adjusted to known working endpoints)
    # Authorize endpoint: root sign-in portal with query params
    authorize-url: https://signin.synapse.org
    # Token endpoint (Synapse repo service)
    token-url: https://repo-prod.prod.sagebase.org/auth/v1/oauth2/token
    # JWKS endpoint (Synapse repo service openid)
    jwks-url: https://repo-prod.prod.sagebase.org/auth/v1/openid/jwks
    client-id: changeme
    client-secret: changeme
    # Use localhost (not 127.0.0.1) so the browser sends the same cookie across app and api if app uses localhost
    redirect-uri: http://127.0.0.1:8113/auth/callback
    # URN-based issuer for consistency across services
    internal-issuer: urn:bixarena:auth
    # Default audience (will be overridden by audience parameter in /oauth2/token)
    audience: urn:bixarena:auth
    token-ttl-seconds: 600
  cors:
    # CORS configuration for browser requests (localhost defaults)
    allowed-origins:
      - http://localhost:8100
      - http://127.0.0.1:8100
      - http://localhost:7860
      - http://127.0.0.1:7860
    allowed-methods:
      - GET
      - POST
      - OPTIONS
    allowed-headers:
      - Authorization
      - Content-Type
      - Cookie
    allow-credentials: true
