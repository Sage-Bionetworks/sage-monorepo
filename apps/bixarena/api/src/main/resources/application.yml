# bixarena-api:
#   welcome-message: 'Welcome to the BixArena API'

server:
  port: 8112

spring:
  application:
    name: bixarena-api
  cache:
    type: redis
    redis:
      time-to-live: 60000 # 1 minute in milliseconds
      cache-null-values: false
  data:
    redis:
      host: bixarena-valkey
      port: 8116
      database: 0
      timeout: 2000ms
      jedis:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 2
  datasource:
    url: jdbc:postgresql://bixarena-postgres:21000/bixarena
    username: postgres
    password: changeme
    driver-class-name: org.postgresql.Driver
    hikari:
      initialization-fail-timeout: -1 # Retry indefinitely during startup
  flyway:
    enabled: true
    clean-disabled: false
    schemas: api
    default-schema: api
    connect-retries: 60 # Retry connection 60 times
    connect-retries-interval: 1s # Wait 1 second between retries
  jackson:
    date-format: org.sagebionetworks.bixarena.api.RFC3339DateFormat
    serialization:
      WRITE_DATES_AS_TIMESTAMPS: false
  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
        jdbc:
          time_zone: UTC
        default_schema: api
    open-in-view: false

management:
  endpoints:
    web:
      base-path: /actuator
      exposure:
        include: health, prometheus
      path-mapping:
        prometheus: metrics
  health:
    readiness-state:
      enabled: true
    liveness-state:
      enabled: true
  endpoint:
    health:
      probes:
        enabled: true
      show-details: always
    prometheus:
      cache.time-to-live: 1ms

info:
  application:
    name: ${spring.application.name}

app:
  welcome-message: 'Welcome to BixArena API'
  auth-service:
    base-url: ${AUTH_SERVICE_BASE_URL:http://bixarena-auth-service:8115}
  jwt:
    # Expected issuer claim value (URN format)
    expected-issuer: urn:bixarena:auth
    # Expected audience claim value
    expected-audience: urn:bixarena:api
  cors:
    # CORS configuration for browser requests (localhost defaults)
    # Can be overridden via env vars (e.g., APP_CORS_ALLOWED_ORIGINS=http://example.com,https://example.com)
    allowed-origins:
      - http://localhost:8100
      - http://127.0.0.1:8100
      - http://localhost:7860
      - http://127.0.0.1:7860
    allowed-methods:
      - GET
      - POST
      - PATCH
      - OPTIONS
    allowed-headers:
      - Authorization
      - Content-Type
    allow-credentials: true
